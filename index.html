    <!DOCTYPE html>
<html>
    <head>
        <script src="./code/sprite.js"></script>
    </head>
    <body>
        <canvas id="gameCanvas" width="800" height="600" />
        
        <script>

            var player = {

                canvas: null,
                direction: 0,
                image: new Image(),
                _x: 50,
                _y: 50,
                size: 11,

                calcPos: function(x, y) {

                    var p = [];
                    p[1] = {
                        x:Math.floor((x - this.size) / world.tileSize),
                        y:Math.floor((y - this.size) / world.tileSize)
                    },
                    p[2] = {
                        x:Math.floor((x) / world.tileSize),
                        y:Math.floor((y - this.size) / world.tileSize)
                    };
                    p[3] = {
                        x:Math.floor((x + this.size) / world.tileSize),
                        y:Math.floor((y - this.size) / world.tileSize)
                    };
                    p[4] = {
                        x:Math.floor((x + this.size) / world.tileSize),
                        y:Math.floor((y) / world.tileSize)
                    };
                    p[5] = {
                        x:Math.floor((x + this.size) / world.tileSize),
                        y:Math.floor((y + this.size) / world.tileSize)
                    };
                    p[6] = {
                        x:Math.floor((x) / world.tileSize),
                        y:Math.floor((y + this.size) / world.tileSize)
                    };
                    p[this.size] = {
                        x:Math.floor((x - this.size) / world.tileSize),
                        y:Math.floor((y + this.size) / world.tileSize)
                    };
                    p[8] = {
                        x:Math.floor((x - this.size) / world.tileSize),
                        y:Math.floor((y) / world.tileSize)
                    };

                    for (idx in p) {

                        player.canvas.strokeStyle = '#F00';
                        player.canvas.strokeRect(p[idx].x * world.tileSize, p[idx].y * world.tileSize, world.tileSize, world.tileSize);

                        if ((world.map[p[idx].y][p[idx].x] != 0)&&(world.map[p[idx].y][p[idx].x] != 4)&&(world.map[p[idx].y][p[idx].x] != 5)) {

                            return false;

                        }

                    }

                    return true;

                },

                move: function(dir) {
                    switch(dir) {
                        case 'Up':
                            this.direction = Math.PI * 1.5;
                            if (player.calcPos(this._x, this._y - 1)) {
                                this._y -= 1;
                            }
                        break;
                        case 'Down':
                            this.direction = Math.PI / 2;
                            if (player.calcPos(this._x, this._y + 1)) {
                                this._y += 1;
                            }
                        break;
                        case 'Left':
                            this.direction = Math.PI;
                            if (player.calcPos(this._x - 1, this._y)) {
                                this._x -= 1;
                            }
                        break;
                        case 'Right':
                            this.direction = 0;
                            if (player.calcPos(this._x + 1, this._y)) {
                                this._x += 1;
                            }
                        break;
                    }
                },
                load: function() {
                    this.image.src = './graphics/tank.png'
                },
                draw: function() {
                    this.canvas.translate(this._x, this._y);
                    this.canvas.rotate(this.direction);
                    this.canvas.drawImage(this.image, -17, -17, 33, 33);
                    this.canvas.rotate(-this.direction);
                    this.canvas.translate(-this._x, -this._y);
                }

            }

            var world = {

                canvas: null,
                tileSize: 33,
                map: null,
                refresh: function() {
                    for (y in this.map) {
                        for (x in this.map[y]) {
                            switch (this.map[y][x]) {
                                case 0 :
                                    this.canvas.fillStyle = '#000';
                                    this.canvas.fillRect(x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                                case 1 :
                                    this.canvas.drawImage(bricks, x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                                case 2 :
                                    this.canvas.drawImage(wall.texture, x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                                case 3 :
                                    this.canvas.drawImage(water, x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                                case 4 :
                                    this.canvas.drawImage(trees, x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                                case 5 :
                                    this.canvas.drawImage(ice, x*world.tileSize, y* world.tileSize, world.tileSize, world.tileSize);
                                break;
                            }
                        }
                    }
                }

            }


            var canvas = document.getElementById('gameCanvas');
            var context = canvas.getContext('2d');
            
            
            /* Images */
            var wall = new Sprite('./graphics/wall.png');
            var water = new Image();
            var trees = new Image();
            var bricks = new Image();
            var ice = new Image();

            bricks.src = "./graphics/bricks.png";
            water.src = "./graphics/water.png";
            trees.src = "./graphics/trees.png";
            ice.src = "./graphics/ice.png";
            player.canvas = context;
            player.load();
            
            /* Fill canvas with black */
            
            context.fillStyle = '#000';
            context.fillRect(0, 0, 10 * world.tileSize, 10 * world.tileSize);
            
            /* Draw Map */

            world.canvas = context;
            world.map = [[1, 1, 1, 4, 0, 0, 1, 1, 0, 0],
                       [1, 0, 1, 4, 1, 0, 1, 2, 0, 1],
                       [1, 0, 1, 4, 1, 0, 1, 2, 0, 1],
                       [1, 0, 0, 0, 0, 1, 1, 1, 0, 1],
                       [1, 3, 3, 1, 0, 4, 4, 5, 0, 0],
                       [3, 0, 0, 1, 0, 1, 1, 5, 0, 0],
                       [1, 0, 0, 0, 0, 1, 1, 5, 0, 0],
                       [1, 1, 0, 1, 0, 1, 0, 5, 0, 0],
                       [0, 0, 0, 1, 0, 0, 0, 5, 0, 0],
                       [1, 1, 0, 2, 1, 1, 1, 2, 1, 1]]
                        
            if (!window.requestAnimationFrame) {

                window.requestAnimationFrame = ( function() {

                    return window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimationFrame ||
                    function( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {
                        window.setTimeout( callback, 1000 / 60 );
                    };

                } )();

            }

            function drawMap(time)
            {
                world.refresh();
                if (dir) player.move(dir);
                player.draw();
                window.requestAnimationFrame(drawMap);
            }

            drawMap();

            var dir = '';

            window.onkeyup = function() {

                dir = '';

            }

            window.onkeydown = function(key) {
                switch(key.keyCode) {
                    case 38:
                        dir = 'Up';
                    break;
                    case 39:
                        dir = 'Right';
                    break;
                    case 40:
                        dir = 'Down';
                    break;
                    case 37:
                        dir = 'Left';
                    break;
                }

            }

        </script>
    </body>
</html>
